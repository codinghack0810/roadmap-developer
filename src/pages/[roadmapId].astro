---
import InteractiveRoadamp from "../components/InteractiveRoadmap/InteractiveRoadmap.astro";
import MarkdownContent from "../components/MarkdownContent/MarkdownContent.astro";
import RoadmapHeader from "../components/RoadmapHeader.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import { getRoadmapIds, RoadmapFrontmatter } from "../lib/roadmap";

export async function getStaticPaths() {
  const roadmapIds = await getRoadmapIds();

  return roadmapIds.map((roadmapId) => ({
    params: { roadmapId },
  }));
}

interface Params extends Record<string, string | undefined> {
  roadmapId: string;
}

const { roadmapId } = Astro.params as Params;
const file = await import(`../roadmaps/${roadmapId}/${roadmapId}.md`);
const frontmatter = file.frontmatter as RoadmapFrontmatter;
---

<BaseLayout title="">
  <RoadmapHeader
    description={frontmatter.description}
    title={frontmatter.title}
    roadmapPermalink={`/${roadmapId}`}
  />

  {
    frontmatter.jsonUrl && (
      <InteractiveRoadamp
        roadmapId={roadmapId}
        description={frontmatter.description}
        roadmapPermalink={`/${roadmapId}`}
        jsonUrl={frontmatter.jsonUrl}
        dimensions={frontmatter.dimensions}
      />
    )
  }

  <MarkdownContent>
    <file.Content />
  </MarkdownContent>
</BaseLayout>
